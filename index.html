<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Cell Data Viewer</title>
  <meta name="description" content="Cell Data Viewer by NerdTech is a web tool for viewing, filtering and exporting cell tower data that you have collected.">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="./assets/resources/file-bar-graph-fill.svg"/>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <link 
    rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
  />

  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css"
  />

  <style>
    html, body {
      -ms-overflow-style: none;  /* IE, old Edge */
      scrollbar-width: none;     /* Firefox */
    }

    /* Chrome, Safari, new Edge, Opera */
    body::-webkit-scrollbar {
      display: none;
    }

    body {
      height: 100dvh;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .cursor-default {
      cursor: default;
    }

    .small-text,
    .marker-popup {
      font-size: 0.875rem; /*14px*/
    }

    .dropdown-menu-scrollable {
      max-height: 13rem; /*208px*/
    }

    @media (max-width: 767px) {
      #map {
        height: calc(100dvh - 12.462rem); /*199.392px*/
      }

      .leaflet-tooltip {
        display: none !important;
      }
    }

    .legend-color-block {
      width: 1rem;
      height: 1rem;
    }

    .leaflet-control-layers-selector {
      top: 0px;
      width: 1rem;
      margin-top: 0px;
      margin-bottom: 0.125rem;
      vertical-align: middle;
    }

    .accordion-button:not(.collapsed) {
      color: inherit;
      background-color: inherit;
      /*ensure that the bottom most accordion button changes shape when the section is opened or closed*/
      border-bottom-left-radius: 0px !important;
      border-bottom-right-radius: 0px !important;
    }

    .custom-tooltip {
      --bs-tooltip-opacity: 1;
    }

    #themeToggle {
      height: 21px;
    }

    #themeToggle label {
      display: flex;
    }
  </style>
</head>
<body class="d-flex flex-column" data-bs-theme="dark"> <!-- body with a dark color theme as a flexible column -->
  <nav class="navbar border-bottom border-secondary" id="navbar"> <!-- styled navbar with a border at the bottom in a light color -->
    <div class="container-fluid"> <!-- always full width container -->
      <div class="d-flex flex-column cursor-default"> <!-- flexible in vertical orientation with default cursor override -->
        <h1 class="navbar-brand mb-0"> <!-- the brand of the website with no margin bottom -->
          <i class="bi bi-file-bar-graph-fill"></i> <!-- bootstrap icons reception bars --> Cell Data Viewer
        </h1>
        <h2 class="text-secondary m-0 small-text"><a href="https://nerdtech.one" target="_blank" class=" text-decoration-none">by NerdTech</a></h2><!-- gray text with no margin and a custom small text -->
      </div>
      <a href="https://github.com/NerdTech-aut/Cell-Data-Viewer" class="text-decoration-none text-secondary cursor-pointer" target="_blank"> <!-- link with no text decoration, gray text and default cursor override -->
        <span><i class="bi bi-file-earmark-code"></i> <!-- bootstrap code icon --> GitHub</span>
      </a>
    </div>
  </nav>
  <div class="bg-primary-subtle container-fluid d-flex flex-grow-1 py-3" id="contentContainer"> <!-- with a dark blue background always full width flexible container which always fills the screen height with 1rem padding top & bottom -->
    <div class="row flex-grow-1 g-3"> <!-- row which always fills the screen height with a gutter between columns of 1.5rem -->
      <div class="col-12 col-md-5 col-xl-4 col-xxl-3"> <!-- element either spanning all 12/12 columns on screen-width < 768px, spanning 5/12 columns on screen-width >= 768px, spanning 4/12 columns on screen-width >= 1200 and spanning 3/12 columns on screen-width >= 1400px -->
        <div class="card h-100 rounded-4 border-secondary-subtle bg-secondary-subtle" id="configCard"> <!-- a card with 100% height in relation to the parent element, a 1rem rounded & subtle lighter border and darker background -->
          <div class="card-header d-md-none cursor-pointer rounded-top-4" data-bs-toggle="collapse" data-bs-target="#filtersCardBody" aria-expanded="true" aria-controls="filtersCardBody" id="mobileHeader"> <!-- header of the card for screen-width < 768px, controls the manual collapsing of the card body, has a manual override for the cursor as a pointer and a border radius for the top-->
            <h5 class="card-title mb-0 d-flex justify-content-between align-items-center">  <!-- title of the card with no margin bottom as a flexbox which pushes the two items inside apart and vertically centers the items -->
              <span>Data & Filters</span>
              <i class="bi bi-chevron-up" id="collapseIcon"></i> <!-- bootstrap icons down arrow -->
            </h5>
          </div>
          <div id="filtersCardBody" class="card-body collapse show"> <!-- card body which is collapsable but not collapsed on load -->
            <h5 class="card-title mb-3 d-none d-md-block">Data & Filters</h5>  <!-- title of the card with 1rem margin bottom and only visible for screen-width >= 768px -->
            <div class="mb-3"> <!-- element with 1rem margin bottom -->
              <label for="csvFile" class="form-label text-secondary small-text text-uppercase">Select CSV <a href="#" data-bs-toggle="tooltip" data-bs-title="Supported sources are CellMapper, G-MoN Pro & Tower Collector - see help for details" data-bs-placement="bottom" data-bs-custom-class="custom-tooltip"><i class="bi bi-info-circle"></i></a></label> <!-- styled label for the CSV file picker button with a lighter text color, smaller text size and uppercase text-->
              <input class="form-control bg-transparent text-secondary border-secondary" type="file" id="csvFile" accept=".csv" autocomplete="off"/> <!-- styled file picker button with a transparent background and light text -->
            </div>
            <div class="mb-3 d-flex justify-content-between align-items-center"> <!-- element with 1rem margin bottom which is a flexbox which pushes the two items inside apart and vertically centers the items -->
              <a id="btnHelp" class="btn btn-sm btn-outline-info" href="https://github.com/NerdTech-aut/Cell-Data-Viewer?tab=readme-ov-file#faq" target="_blank">Help</a> <!-- link which is styled as a compact outlined info button -->
              <span class="badge badge-pill text-bg-secondary py-2 small-text cursor-default"> <!-- points counter as a badge pill with gray secondary background, 0.5rem margin top and bottom and custom font size as well as a cursor type override to default -->
                <span id="visibleCount">0</span> / <span id="totalCount">0</span> points
              </span>
            </div>
            <div class="row g-2 mb-3"> <!-- row with a gutter between columns of 0.75rem and 1rem margin bottom -->
              <div class="col-6 mt-0"> <!-- element which spans 6/12 columns and no margin top -->
                <label class="form-label text-secondary small-text text-uppercase">PLMN</label> <!-- styled label with a lighter text color, smaller text size and uppercase text -->
                <div class="dropdown" id="filterPlmn"> <!-- styled dropdown -->
                  <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="filterPlmnBtn" data-bs-toggle="dropdown" aria-expanded="false"> <!-- button which is styled as a outlined secondary button with the full width of the parent element, left aligned text and a dropdown arrow-->
                    <span id="filterPlmnSelected">All</span> <!-- default button text -->
                  </button>
                  <div class="dropdown-menu pt-0 w-100 z-1"> <!-- dropdown menu with no padding top, it fills the full width of the parent element and has a high z-index to be in-front of all map elements-->
                    <ul class="pt-0 mb-0 list-unstyled"> <!-- list with no padding top, no margin bottom and no default styling -->
                      <li class="p-2 border-bottom border-secondary-subtle"> <!-- list element for search with a padding from all sides of 0.5rem and a border at the bottom with a subtle style -->
                        <input type="text" class="form-control form-control-sm border-secondary" id="filterPlmnSearch" placeholder="Type to search..." autocomplete="off"> <!-- styled text input as a compact form field and a darker border -->
                      </li>
                    </ul>
                    <ul class="dropdown-menu-scrollable overflow-y-auto mb-0 list-unstyled" id="filterPlmnUL"> <!-- list with a max-height after which it turns into a scrollable list, no margin bottom and no default styling -->
                      <li>
                        <a class="dropdown-item" href="#" data-value="">All</a> <!-- styled dropdown item -->
                      </li>
                      <li id="filterPlmnNoResults" class="dropdown-item text-muted d-none user-select-none">No matches found</li> <!-- No results dropdown-item with gray text, not visible by default and not user selectable -->
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col-6 mt-0"> <!-- element which spans 6/12 columns and no margin top -->
                <label class="form-label text-secondary small-text text-uppercase">Type</label> <!-- styled label with a lighter text color, smaller text size and uppercase text -->
                <div class="dropdown" id="filterType"> <!-- styled dropdown -->
                  <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="filterTypeBtn" data-bs-toggle="dropdown" aria-expanded="false"> <!-- button which is styled as a outlined secondary button with the full width of the parent element, left aligned text and a dropdown arrow-->
                    <span id="filterTypeSelected">All</span> <!-- default button text -->
                  </button>
                  <div class="dropdown-menu pt-0 w-100 z-1"> <!-- dropdown menu with no padding top, it fills the full width of the parent element and has a high z-index to be in-front of all map elements-->
                    <ul class="pt-0 mb-0 list-unstyled"> <!-- list with no padding top, no margin bottom and no default styling -->
                      <li class="p-2 border-bottom border-secondary-subtle"> <!-- list element for search with a padding from all sides of 0.5rem and a border at the bottom with a subtle style -->
                        <input type="text" class="form-control form-control-sm border-secondary" id="filterTypeSearch" placeholder="Type to search..." autocomplete="off"> <!-- styled text input as a compact form field and a darker border -->
                      </li>
                    </ul>
                    <ul class="dropdown-menu-scrollable overflow-y-auto mb-0 list-unstyled" id="filterTypeUL"> <!-- list with a max-height after which it turns into a scrollable list, no margin bottom and no default styling -->
                      <li>
                        <a class="dropdown-item" href="#" data-value="">All</a> <!-- styled dropdown item -->
                      </li>
                      <li id="filterTypeNoResults" class="dropdown-item text-muted d-none user-select-none">No matches found</li> <!-- No results dropdown-item with gray text, not visible by default and not user selectable -->
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="row g-2 mb-3"> <!-- row with a gutter between columns of 0.75rem and 1rem margin bottom -->
              <div class="col-6 mt-0"> <!-- element which spans 6/12 columns and no margin top -->
                <label class="form-label text-secondary small-text text-uppercase">Band</label> <!-- styled label with a lighter text color, smaller text size and uppercase text -->
                <div class="dropdown" id="filterBand"> <!-- styled dropdown -->
                  <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="filterBandBtn" data-bs-toggle="dropdown" aria-expanded="false"> <!-- button which is styled as a outlined secondary button with the full width of the parent element, left aligned text and a dropdown arrow-->
                    <span id="filterBandSelected">All</span> <!-- default button text -->
                  </button>
                  <div class="dropdown-menu pt-0 w-100 z-1"> <!-- dropdown menu with no padding top, it fills the full width of the parent element and has a high z-index to be in-front of all map elements-->
                    <ul class="pt-0 mb-0 list-unstyled"> <!-- list with no padding top, no margin bottom and no default styling -->
                      <li class="p-2 border-bottom border-secondary-subtle"> <!-- list element for search with a padding from all sides of 0.5rem and a border at the bottom with a subtle style -->
                        <input type="text" class="form-control form-control-sm border-secondary" id="filterBandSearch" placeholder="Type to search..." autocomplete="off"> <!-- styled text input as a compact form field and a darker border -->
                      </li>
                    </ul>
                    <ul class="dropdown-menu-scrollable overflow-y-auto mb-0 list-unstyled" id="filterBandUL"> <!-- list with a max-height after which it turns into a scrollable list, no margin bottom and no default styling -->
                      <li>
                        <a class="dropdown-item" href="#" data-value="">All</a> <!-- styled dropdown item -->
                      </li>
                      <li id="filterBandNoResults" class="dropdown-item text-muted d-none user-select-none">No matches found</li> <!-- No results dropdown-item with gray text, not visible by default and not user selectable -->
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col-6 mt-0"> <!-- element which spans 6/12 columns and no margin top -->
                <label class="form-label text-secondary small-text text-uppercase">Frequency</label> <!-- styled label with a lighter text color, smaller text size and uppercase text -->
                <div class="dropdown" id="filterFrequency"> <!-- styled dropdown -->
                  <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="filterFrequencyBtn" data-bs-toggle="dropdown" aria-expanded="false"> <!-- button which is styled as a outlined secondary button with the full width of the parent element, left aligned text and a dropdown arrow-->
                    <span id="filterFrequencySelected">All</span> <!-- default button text -->
                  </button>
                  <div class="dropdown-menu pt-0 w-100 z-1"> <!-- dropdown menu with no padding top, it fills the full width of the parent element and has a high z-index to be in-front of all map elements-->
                    <ul class="pt-0 mb-0 list-unstyled"> <!-- list with no padding top, no margin bottom and no default styling -->
                      <li class="p-2 border-bottom border-secondary-subtle"> <!-- list element for search with a padding from all sides of 0.5rem and a border at the bottom with a subtle style -->
                        <input type="text" class="form-control form-control-sm border-secondary" id="filterFrequencySearch" placeholder="Type to search..." autocomplete="off"> <!-- styled text input as a compact form field and a darker border -->
                      </li>
                    </ul>
                    <ul class="dropdown-menu-scrollable z-1 overflow-y-auto mb-0 list-unstyled" id="filterFrequencyUL"> <!-- list with a max-height after which it turns into a scrollable list, no margin bottom and no default styling -->
                      <li>
                        <a class="dropdown-item" href="#" data-value="">All</a> <!-- styled dropdown item -->
                      </li>                      
                      <li id="filterFrequencyNoResults" class="dropdown-item text-muted d-none user-select-none">No matches found</li> <!-- No results dropdown-item with gray text, not visible by default and not user selectable -->
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="row g-2 mb-3"> <!-- row with a gutter between columns of 0.75rem and 1rem margin bottom -->
              <div class="col-6 mt-0"> <!-- element which spans 6/12 columns and no margin top -->
                <label class="form-label text-secondary small-text text-uppercase" >NB</label> <!-- styled label with a lighter text color, smaller text size and uppercase text -->
                <div class="dropdown" id="filterNb"> <!-- styled dropdown -->
                  <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="filterNbBtn" data-bs-toggle="dropdown" aria-expanded="false"> <!-- button which is styled as a outlined secondary button with the full width of the parent element, left aligned text and a dropdown arrow-->
                    <span id="filterNbSelected">All</span> <!-- default button text -->
                  </button>
                  <div class="dropdown-menu pt-0 w-100 z-1"> <!-- dropdown menu with no padding top, it fills the full width of the parent element and has a high z-index to be in-front of all map elements-->
                    <ul class="pt-0 mb-0 list-unstyled"> <!-- list with no padding top, no margin bottom and no default styling -->
                      <li class="p-2 border-bottom border-secondary-subtle"> <!-- list element for search with a padding from all sides of 0.5rem and a border at the bottom with a subtle style -->
                        <input type="text" class="form-control form-control-sm border-secondary" id="filterNbSearch" placeholder="Type to search..." autocomplete="off"> <!-- styled text input as a compact form field and a darker border -->
                      </li>
                    </ul>
                    <ul class="dropdown-menu-scrollable overflow-y-auto mb-0 list-unstyled" id="filterNbUL"> <!-- list with a max-height after which it turns into a scrollable list, no margin bottom and no default styling -->
                      <li>
                        <a class="dropdown-item" href="#" data-value="">All</a> <!-- styled dropdown item -->
                      </li>
                      <li id="filterNbNoResults" class="dropdown-item text-muted d-none user-select-none">No matches found</li> <!-- No results dropdown-item with gray text, not visible by default and not user selectable -->
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col-6 mt-0"> <!-- element which spans 6/12 columns and no margin top -->
                <label class="form-label text-secondary small-text text-uppercase">Cell</label> <!-- styled label with a lighter text color, smaller text size and uppercase text -->
                <div class="dropdown" id="filterCell"> <!-- styled dropdown -->
                  <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="filterCellBtn" data-bs-toggle="dropdown" aria-expanded="false"> <!-- button which is styled as a outlined secondary button with the full width of the parent element, left aligned text and a dropdown arrow-->
                    <span id="filterCellSelected">All</span> <!-- default button text -->
                  </button>
                  <div class="dropdown-menu pt-0 w-100 z-1"> <!-- dropdown menu with no padding top, it fills the full width of the parent element and has a high z-index to be in-front of all map elements-->
                    <ul class="pt-0 mb-0 list-unstyled"> <!-- list with no padding top, no margin bottom and no default styling -->
                      <li class="p-2 border-bottom border-secondary-subtle"> <!-- list element for search with a padding from all sides of 0.5rem and a border at the bottom with a subtle style -->
                        <input type="text" class="form-control form-control-sm border-secondary" id="filterCellSearch" placeholder="Type to search..." autocomplete="off"> <!-- styled text input as a compact form field and a darker border -->
                      </li>
                    </ul>
                    <ul class="dropdown-menu-scrollable overflow-y-auto mb-0 list-unstyled" id="filterCellUL"> <!-- list with a max-height after which it turns into a scrollable list, no margin bottom and no default styling -->
                      <li>
                        <a class="dropdown-item" href="#" data-value="">All</a> <!-- styled dropdown item -->
                      </li>
                      <li id="filterCellNoResults" class="dropdown-item text-muted d-none user-select-none">No matches found</li> <!-- No results dropdown-item with gray text, not visible by default and not user selectable -->
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="d-flex justify-content-between align-items-center"> <!-- element which is a flexbox which pushes the two items inside apart and vertically centers the items -->
              <button id="btnClearFilters" class="btn btn-sm btn-outline-danger">  <!-- button which is styled as a compact outlined danger button -->
                Clear filters
              </button>
              <button id="btnSaveMap" class="btn btn-sm btn-success"> <!-- button which is styled as a compact success button -->
                Save map
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-7 col-xl-8 col-xxl-9 d-flex flex-grow-1" data-bs-theme="light"> <!-- element either spanning all 12/12 columns on screen-width < 768px, spanning 7/12 columns on screen-width >= 768px, spanning 8/12 columns on screen-width >= 1200 and spanning 9/12 columns on screen-width >= 1400px and flexible & fills the remaining screen height -->
        <div id="map" class="rounded-4 shadow-none z-0 d-flex flex-grow-1"></div> <!-- map with 1rem border radius, no shadow, z-index of 0 and flexible & fills the remaining screen height -->
      </div>
    </div>
  </div>
  
  <div class="modal fade" id="emptyMapModel" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true"> <!-- model to show when user wants to save an empty map which can fade in & out and needs to be acknowledged through a static backdrop-->
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5 cursor-default" id="staticBackdropLabel">Map save</h1>
        </div>
        <div class="modal-body">
          <p>No visible points to save on the map.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Understood</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="successfulMapModel" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true"> <!-- model to show when user wants to save map with points on browsers that don't support save file dialog which can fade in & out and needs to be acknowledged through a static backdrop-->
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5 cursor-default" id="staticBackdropLabel">Map save</h1>
        </div>
        <div class="modal-body cursor-default">
          <p id="successfulMapModelText"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">No</button>
          <button type="button" class="btn btn-success" id="btnDownload">Yes</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="text-secondary px-3 py-2 border-top border-secondary d-flex justify-content-between align-items-center"> <!-- footer with gray text, padding left and right of 1rem, padding top and bottom of 0.5rem, border top with a light color as a flexbox which pushes the two items inside apart and vertically centers the items -->
    <small><a href="#" data-bs-toggle="modal" data-bs-target="#imprintModal" class="text-decoration-none text-secondary">Impressum</a> | <a href="#" data-bs-toggle="modal" data-bs-target="#privacyPolicyModal" class="text-decoration-none text-secondary">Datenschutz</a></small>
    <div id="themeToggle">
      <label class="cursor-pointer small-text"> <!-- default cursor override and a custom small text -->
        <i class="bi bi-moon-fill" id="themeIcon"></i> <!-- bootstrap icons moon -->
      </label>
    </div>
  </footer>

  <div class="modal fade" id="imprintModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">
        <div class="modal-header navbar-bg py-2">
          <p class="navbar-brand fw-bold fs-5 navigation-link mb-0 py-1">Cell Data Viewer</p>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="row justify-content-center">
              <div class="col-12 col-xxl-6 text-center mt-3 mb-4">
                <h1>Impressum</h1>
              </div>
            </div>
            <div class="row g-3 mb-3 justify-content-center">
              <div class="col-12 col-xxl-6 text-center p-0">
                <div class="accordion" id="imprintAccordion">
                  <div class="accordion-item rounded-top-4">
                    <h2 class="accordion-header">
                      <button class="accordion-button rounded-top-4 shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOneImprint" aria-expanded="true" aria-controls="collapseOneImprint">
                        Allgemeine Informationen & Anschrift
                      </button>
                    </h2>
                    <div id="collapseOneImprint" class="accordion-collapse collapse show" data-bs-parent="#imprintAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Allgemeine Informationen & Anschrift</h3>
                                <p><b>Informationen und Offenlegung gemäß &sect;5 (1) ECG, &sect; 25 MedienG, &sect; 63 GewO und &sect; 14 UGB</b></p>
                                <ul class="list-group list-group-flush">
                                  <li class="list-group-item border-0">Webseitenbetreiber: Florian Jeschek</li>
                                  <li class="list-group-item border-0">Anschrift: Hohenfelsplatz 2/7 1120 Wien Österreich</li>
                                  <li class="list-group-item border-0">E-Mail: <a href="mailto:contact@nerdtech.one">contact@nerdtech.one</a></li>
                                  <li class="list-group-item border-0">Anwendbare Rechtsvorschrift: <a href="https://www.ris.bka.gv.at" target="_blank">www.ris.bka.gv.at</a></li>
                                </ul>
                                <p class="mb-0">Rechtstext von Quelle: <a href="https://www.fairesrecht.at/kostenlos-impressum-erstellen-generator.php" target="_blank">Impressum Generator</a> in Kooperation mit <a href="https://rechtsanwaltwien.com/arzthaftung" target="_blank">Medizinrecht Rechtsanwalt</a></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwoImprint" aria-expanded="true" aria-controls="collapseTwoImprint">
                        Online Streitbeilegung
                      </button>
                    </h2>
                    <div id="collapseTwoImprint" class="accordion-collapse collapse" data-bs-parent="#imprintAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Online Streitbeilegung</h3>
                                <p>Verbraucher, welche in Österreich oder in einem sonstigen Vertragsstaat der ODR-VO niedergelassen sind, haben die Möglichkeit Probleme bezüglich dem entgeltlichen Kauf von Waren oder Dienstleistungen im Rahmen einer Online-Streitbeilegung (nach OS, AStG) zu lösen. Die Europäische Kommission stellt eine Plattform hierfür bereit: https://ec.europa.eu/consumers/odr</p>
                                <p class="mb-0">Rechtstext von Quelle: <a href="https://www.fairesrecht.at/kostenlos-impressum-erstellen-generator.php" target="_blank">Impressum Generator</a> in Kooperation mit <a href="https://rechtsanwaltwien.com/arzthaftung" target="_blank">Medizinrecht Rechtsanwalt</a></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThreeImprint" aria-expanded="false" aria-controls="collapseThreeImprint">
                        Urheberrecht
                      </button>
                    </h2>
                    <div id="collapseThreeImprint" class="accordion-collapse collapse" data-bs-parent="#imprintAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Urheberrecht</h3>
                                <p>Die Inhalte dieser Webseite unterliegen, soweit dies rechtlich möglich ist, diversen Schutzrechten (z.B dem Urheberrecht). Jegliche Verwendung/Verbreitung von bereitgestelltem Material, welche urheberrechtlich untersagt ist, bedarf schriftlicher Zustimmung des Webseitenbetreibers.</p>
                                <p class="mb-0">Rechtstext von Quelle: <a href="https://www.fairesrecht.at/kostenlos-impressum-erstellen-generator.php" target="_blank">Impressum Generator</a> in Kooperation mit <a href="https://rechtsanwaltwien.com/arzthaftung" target="_blank">Medizinrecht Rechtsanwalt</a></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFiveImprint" aria-expanded="false" aria-controls="collapseFiveImprint">
                        Haftungsausschluss
                      </button>
                    </h2>
                    <div id="collapseFiveImprint" class="accordion-collapse collapse" data-bs-parent="#imprintAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Haftungsausschluss</h3>
                                <p>Trotz sorgfältiger inhaltlicher Kontrolle übernimmt der Webseitenbetreiber dieser Webseite keine Haftung für die Inhalte externer Links. Für den Inhalt der verlinkten Seiten sind ausschließlich deren Betreiber verantwortlich. Sollten Sie dennoch auf ausgehende Links aufmerksam werden, welche auf eine Webseite mit rechtswidriger Tätigkeit/Information verweisen, ersuchen wir um dementsprechenden Hinweis, um diese nach § 17 Abs. 2 ECG umgehend zu entfernen.</p>
                                <p>Die Urheberrechte Dritter werden vom Betreiber dieser Webseite mit größter Sorgfalt beachtet. Sollten Sie trotzdem auf eine Urheberrechtsverletzung aufmerksam werden, bitten wir um einen entsprechenden Hinweis. Bei Bekanntwerden derartiger Rechtsverletzungen werden wir den betroffenen Inhalt umgehend entfernen.</p>
                                <p class="mb-0">Rechtstext von Quelle: <a href="https://www.fairesrecht.at/kostenlos-impressum-erstellen-generator.php" target="_blank">Impressum Generator</a> in Kooperation mit <a href="https://rechtsanwaltwien.com/arzthaftung" target="_blank">Medizinrecht Rechtsanwalt</a></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFourImprint" aria-expanded="false" aria-controls="collapseFourImprint">
                        Markenhinweise
                      </button>
                    </h2>
                    <div id="collapseFourImprint" class="accordion-collapse collapse" data-bs-parent="#imprintAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Markenhinweise</h3>
                                <p>CellMapper ist eine Marke der CellMapper Services Limited</p>
                                <p>GitHub und das GitHub Logo sind Marken der GitHub Inc.</p>
                                <p class="mb-0">jsDelivr ist eine Marke der Volentio JSD Limited</p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item rounded-bottom-4">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed rounded-bottom-4 shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSixImprint" aria-expanded="false" aria-controls="collapseSixImprint">
                        Bildernachweis
                      </button>
                    </h2>
                    <div id="collapseSixImprint" class="accordion-collapse collapse" data-bs-parent="#imprintAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3 rounded-bottom-4">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Bildernachweis</h3>
                                <p>Die Icons sind <a href="https://icons.getbootstrap.com/" target="_blank">Bootstrap Icons</a> vom Bootstrap Team und Mitwirkenden unter der <a href="https://github.com/twbs/bootstrap/blob/main/LICENSE" target="_blank">MIT License</a>.</p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer navbar-bg">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Schließen</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="privacyPolicyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">
        <div class="modal-header navbar-bg py-2">
          <p class="navbar-brand fw-bold fs-5 navigation-link mb-0 py-1">Cell Data Viewer</p>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="row justify-content-center">
              <div class="col-12 col-xxl-6 text-center mt-3 mb-4">
                <h1>Datenschutzerklärung</h1>
              </div>
            </div>
            <div class="row g-3 mb-3 justify-content-center">
              <div class="col-12 col-xxl-6 text-center p-0">
                <div class="accordion" id="privacyPolicyAccordion">
                  <div class="accordion-item rounded-top-4">
                    <h2 class="accordion-header">
                      <button class="accordion-button rounded-top-4 shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOnePrivacyPolicy" aria-expanded="true" aria-controls="collapseOnePrivacyPolicy">
                        Allgemeine Informationen
                      </button>
                    </h2>
                    <div id="collapseOnePrivacyPolicy" class="accordion-collapse collapse show" data-bs-parent="#privacyPolicyAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Allgemeine Informationen</h3>
                                <p>In folgender Datenschutzerklärung informiere ich Sie über die wichtigsten Aspekte der Datenverarbeitung im Rahmen unserer Webseite. Ich erhebe und verarbeite personenbezogene Daten nur auf Grundlage der gesetzlichen Bestimmungen (Datenschutzgrundverordnung, Telekommunikationsgesetz 2003).</p>
                                <p>Sobald Sie als Benutzer auf diese Webseite zugreifen oder diese besuchen wird Ihre IP-Adresse, Beginn sowie Beginn und Ende der Sitzung erfasst. Dies ist technisch bedingt und stellt somit ein berechtigtes Interesse iSv Art 6 Abs 1 lit f DSGVO.</p>
                                <p class="mb-0">Rechtstext von Quelle: <a href="https://fairesrecht.at/kostenlos-datenschutzerklaerung-erstellen-generator.php" target="_blank">DSGVO Datenschutz Generator</a> in Kooperation mit <a href="https://kredit123.at/home" target="_blank">Online Kreditvergleich</a></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwoPrivacyPolicy" aria-expanded="true" aria-controls="collapseTwoPrivacyPolicy">
                        Kontakt
                      </button>
                    </h2>
                    <div id="collapseTwoPrivacyPolicy" class="accordion-collapse collapse" data-bs-parent="#privacyPolicyAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Kontakt</h3>
                                <p>Webseitenbetreiber:</p>
                                <p>Florian Jeschek</p>
                                <p>Sie erreichen mich unter folgenden Kontaktdaten:</p>
                                <p>Email:                                    
                                  <a href="mailto:contact@nerdtech.one" class="text-decoration-none">
                                    contact@nerdtech.one
                                  </a>
                                </p>
                                <p>Wenn Sie mich per Email kontaktieren, dann werden die von Ihnen an übermittelten Daten zwecks Bearbeitung Ihrer Anfrage oder für den Fall von weiteren Anschlussfragen gespeichert. Es erfolgt, ohne Ihre Einwilligung, keine Weitergabe Ihrer übermittelten Daten.</p>
                                <p class="mb-0">Rechtstext von Quelle: <a href="https://fairesrecht.at/kostenlos-datenschutzerklaerung-erstellen-generator.php" target="_blank">DSGVO Datenschutz Generator</a> in Kooperation mit <a href="https://kredit123.at/home" target="_blank">Online Kreditvergleich</a></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThreePrivacyPolicy" aria-expanded="false" aria-controls="collapseThreePrivacyPolicy">
                        Hosting mit GitHub Pages
                      </button>
                    </h2>
                    <div id="collapseThreePrivacyPolicy" class="accordion-collapse collapse" data-bs-parent="#privacyPolicyAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Hosting mit Github Pages</h3>
                                <p>Der Hoster erhebt in sog. Logfiles folgende Daten, die Ihr Browser übermittelt:</p>
                                <p>IP-Adresse, die Adresse der vorher besuchten Website (Referer Anfrage-Header), Datum und Uhrzeit der Anfrage, Zeitzonendifferenz zur Greenwich Mean Time, Inhalt der Anforderung, HTTP-Statuscode, übertragene Datenmenge, Website, von der die Anforderung kommt und Informationen zu Browser und Betriebssystem.</p>
                                <p>Das ist erforderlich, um die Website anzuzeigen und die Stabilität und Sicherheit zu gewährleisten. Dies entspricht dem berechtigten Interesse im Sinne des Art. 6 Abs. 1 S. 1 lit. f DSGVO.</p>
                                <p>Es erfolgt kein Tracking und ich habe auf diese Daten keinen direkten Zugriff.</p>
                                <p>Ich setzen für die Zurverfügungstellung dieser Website folgenden Hoster ein:</p>
                                <p>GitHub Inc.</p>
                                <p>88 Colin P Kelly Jr St</p>
                                <p>San Francisco, CA 94107, United States</p>
                                <p>GitHub B.V.</p>
                                <p>Prins Bernhardplein 200</p>
                                <p>Amsterdam 1097JB, The Netherlands</p>
                                <p><a href="mailto:dpo@github.com">dpo@github.com</a></p>
                                <p>Dieser ist Empfänger Ihrer personenbezogenen Daten. Dies entspricht dem berechtigten Interesse im Sinne des Art. 6 Abs. 1 S. 1 lit. f DSGVO, selbst keinen Server in den eigenen Räumlichkeiten vorhalten zu müssen. Serverstandort ist USA.</p>
                                <p>Weitere Informationen zu Widerspruchs- und Beseitigungsmöglichkeiten gegenüber GitHub finden Sie unter:</p>
                                <p><a href="https://docs.github.com/en/site-policy/privacy-policies" target="_blank">https://docs.github.com/en/site-policy/privacy-policies</a></p>
                                <p>Sie haben das Recht der Verarbeitung zu widersprechen. Ob der Widerspruch erfolgreich ist, ist im Rahmen einer Interessenabwägung zu ermitteln.</p>
                                <p>Die Daten werden gelöscht, sobald der Zweck der Verarbeitung entfällt.</p>
                                <p>Die Verarbeitung der unter diesem Abschnitt angegebenen Daten ist weder gesetzlich noch vertraglich vorgeschrieben. Die Funktionsfähigkeit der Website ist ohne die Verarbeitung nicht gewährleistet.</p>
                                <p>GitHub hat Compliance-Maßnahmen für internationale Datenübermittlungen umgesetzt. Diese gelten für alle weltweiten Aktivitäten, bei denen GitHub personenbezogene Daten von natürlichen Personen in der EU verarbeitet. Diese Maßnahmen basieren auf den EU-Standardvertragsklauseln (SCCs). Weitere Informationen finden Sie unter:</p>
                                <p><a href="https://github.com/customer-terms/github-data-protection-agreement" target="_blank">https://github.com/customer-terms/github-data-protection-agreement</a></p>
                                <p class="mb-0">Rechtstext von Quelle: <a href="https://opr.vc" target="_blank">open privacy by opr.vc</a></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFourPrivacyPolicy" aria-expanded="false" aria-controls="collapseFourPrivacyPolicy">
                        jsDelivr CDN
                      </button>
                    </h2>
                    <div id="collapseFourPrivacyPolicy" class="accordion-collapse collapse" data-bs-parent="#privacyPolicyAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>jsDelivr CDN</h3>
                                <p>Zur Optimierung der Abrufgeschwindigkeit, der Gestaltung und Darstellung der Inhalte des Internetauftritts auf unterschiedlichen Endgeräten setze ich in diesem Internetauftritt den Dienst jsdeliver.com, ein Content Delivery Network („CDN“), ein. Hierbei handelt es sich um einen Open-Source-Dienst der</p>
                                <p>Volentio JSD Limited</p>
                                <p>Suite 2a1, Northside House, Mount Pleasant,</p> 
                                <p>Barnet, EN4 9EB, England, United Kingdom.</p>
                                <p>Um die Inhalte dieses Internetauftritts schnell ausliefern zu können, greift der Dienst auf sog. JavaScript-Bibliotheken zurück. Dabei werden entsprechende Dateien von einem Drittserver geladen, der Ihre IP-Adresse erfasst. Ich haben dabei keinen Einfluss darauf, ob Ihre IP-Adresse durch Dritte zu statistischen Zwecken verarbeitet wird.</p>
                                <p>Die Volentio JSD Limited bietet unter <a href="https://www.jsdelivr.com/terms/privacy-policy" rel="nofollow noopener" target="_blank">https://www.jsdelivr.com/terms/privacy-policy</a> weitergehende Datenschutzinformationen an.</p>
                                <p>Rechtsgrundlage ist Art. 6 Abs. 1 lit. f) DSGVO. Das berechtigte Interesse liegt in der Beschleunigung der Ladezeiten des Internetauftritts sowie in dessen Optimierung.</p>
                                <p>Um die Ausführung des Java-Script-Codes von jsdeliver.net insgesamt zu verhindern, können Sie einen sog. Java-Script-Blocker installieren, wie bspw. <a href="https://noscript.ne" target="_blank">noscript.net</a> oder <a href="https://www.ghostery.com/">ghostery.com</a>. Sollten Sie die Ausführung des Java-Script-Codes verhindern oder einschränken, kann dies aus technischen Gründen allerdings dazu führen, dass womöglich nicht sämtliche Inhalte und Funktionen dieses Internetauftritts verfügbar sind.</p>
                                <p class="mb-0">Rechtstext von Quelle: <a href="https://www.generator-datenschutzerklärung.de" target="_blank">Muster-Datenschutzerklärung</a> der <a href="https://www.bewertung-löschen24.de" target="_blank">Anwaltskanzlei Weiß &amp; Partner</a></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFivePrivacyPolicy" aria-expanded="false" aria-controls="collapseFivePrivacyPolicy">
                        Kartendaten
                      </button>
                    </h2>
                    <div id="collapseFivePrivacyPolicy" class="accordion-collapse collapse" data-bs-parent="#privacyPolicyAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Kartendaten</h3>
                                <p>Um die Funktionalität dieser Webseite bereitzustellen werden die jeweils aktuellen Kartendaten der Dienste openstreetmap.org und arcgis.com über deren Tile-Server als Bilddateien abgerufen. </p>
                                <p>Bei OpenStreetMap handelt es sich um einen Kartendienst welcher bereitgestellt wird von der</p>
                                <p>OpenStreetMap Foundation</p>
                                <p>St John's Innovation Centre, Cowley Road,</p> 
                                <p>Cambridge, CB4 0WS, England, United Kingdom.</p>
                                <p>Die OpenStreetMap Foundation bietet unter <a href="https://osmfoundation.org/wiki/Privacy_Policy" rel="nofollow noopener" target="_blank">https://osmfoundation.org/wiki/Privacy_Policy</a> weitergehende Datenschutzinformationen an.</p>
                                <p>Bei ArcGIS handelt es sich um einen Kartendienst welcher bereitgestellt wird von der</p>
                                <p>ESRI Inc.</p>
                                <p>380 New York Street,</p> 
                                <p>Redlands, 92373, California, USA.</p>
                                <p>Die ESRI Inc. bietet unter <a href="https://trust.arcgis.com/en/privacy/privacy-tab-intro.htm" rel="nofollow noopener" target="_blank">https://trust.arcgis.com/en/privacy/privacy-tab-intro.htm</a> weitergehende Datenschutzinformationen an.</p>
                                <p>Um die Verwendung der aktuellen Kartendaten sicherzustellen wird auf sogenannte Tile-Server zurückgegriffen. Dabei werden entsprechende Dateien von einem Drittserver geladen, der Ihre IP-Adresse erfasst. Ich haben dabei keinen Einfluss darauf, ob Ihre IP-Adresse durch Dritte zu statistischen Zwecken verarbeitet wird.</p>
                                <p>Rechtsgrundlage ist Art. 6 Abs. 1 lit. f) DSGVO. Das berechtigte Interesse liegt in der Verwendung von aktuellem Kartenmaterial als wichtige Grundlage für die Funktionalität dieser Webseite.</p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item rounded-bottom-4">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed rounded-bottom-4 shadow-none border-bottom border-secondary fs-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSixPrivacyPolicy" aria-expanded="false" aria-controls="collapseSixPrivacyPolicy">
                        Ihre Rechte als Betroffener
                      </button>
                    </h2>
                    <div id="collapseSixPrivacyPolicy" class="accordion-collapse collapse" data-bs-parent="#privacyPolicyAccordion">
                      <div class="accordion-body border-bottom border-secondary px-3 rounded-bottom-4">
                        <div class="container-fluid px-0">
                          <div class="row g-3">
                            <div class="col-12">
                              <div class="text-center px-3 h-100">
                                <h3>Ihre Rechte als Betroffener</h3>
                                <p>Sie als Betroffener haben bezüglich Ihrer Daten, welche gespeichert sind grundsätzlich ein Recht auf:</p>
                                <ul class="list-group list-group-flush mb-3">
                                  <li class="list-group-item border-0">Auskunft</li>
                                  <li class="list-group-item border-0">Löschung der Daten</li>
                                  <li class="list-group-item border-0">Berichtigung der Daten</li>
                                  <li class="list-group-item border-0">Übertragbarkeit der Daten</li>
                                  <li class="list-group-item border-0">Widerruf und Widerspruch zur Datenverarbeitung</li>
                                  <li class="list-group-item border-0">Einschränkung</li>
                                </ul>
                                <p>Wenn sie vermuten, dass im Zuge der Verarbeitung Ihrer Daten Verstöße gegen das Datenschutzrecht passiert sind, so haben Sie die Möglichkeit sich bei <a href="mailto:contact@nerdtech.one">contact@nerdtech.one</a> oder der Datenschutzbehörde zu beschweren.</p>
                                <p class="mb-0">Rechtstext von Quelle: <a href="https://fairesrecht.at/kostenlos-datenschutzerklaerung-erstellen-generator.php" target="_blank">DSGVO Datenschutz Generator</a> in Kooperation mit <a href="https://kredit123.at/home" target="_blank">Online Kreditvergleich</a></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer navbar-bg">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Schließen</button>
        </div>
      </div>
    </div>
  </div>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js">
  </script>

  <script
    src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js">
  </script>

  <script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

    const browserTheme = window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
    const savedTheme = localStorage.getItem('savedTheme') || browserTheme;

    const bodyElement = document.body;
    const contentContainer = document.getElementById('contentContainer');
    const configCard = document.getElementById('configCard');
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');

    //set the theme on load
    updateTheme(savedTheme, savedTheme === 'light', savedTheme === 'dark');

    const filterPlmnSelected = document.getElementById('filterPlmnSelected');
    const filterTypeSelected = document.getElementById('filterTypeSelected');
    const filterBandSelected = document.getElementById('filterBandSelected');
    const filterFrequencySelected = document.getElementById('filterFrequencySelected');
    const filterNbSelected = document.getElementById('filterNbSelected');
    const filterCellSelected = document.getElementById('filterCellSelected');

    const visibleCount = document.getElementById("visibleCount");
    const totalCount = document.getElementById("totalCount");
    
    const mobileHeader = document.getElementById("mobileHeader");
    const collapseIcon = document.getElementById("collapseIcon");
    const cardBody = document.getElementById('filtersCardBody');

    const csvFile = document.getElementById("csvFile");
    const btnClearFilters = document.getElementById("btnClearFilters");
    const btnSaveMap = document.getElementById('btnSaveMap');
    const btnDownload = document.getElementById('btnDownload');

    const dropdowns = document.querySelectorAll('.dropdown');

    const emptyMapModel = new bootstrap.Modal(document.getElementById('emptyMapModel'));
    const successfulMapModelText = document.getElementById('successfulMapModelText')
    const successfulMapModel = new bootstrap.Modal(document.getElementById('successfulMapModel'));

    const headersCM = ['Latitude', 'Longitude', 'Altitude', 'MCC', 'MNC', 'LAC', 'Cell', 'Signal', 'Type', 'Subtype', 'ARFCN', 'PCI'];
    const headersGMP = ['PLMN', 'SYSTEM', 'XCI', 'xNBID', 'LOCAL_CID', 'LAC/TAC', 'PCI/PSC/BSIC', 'ARFCN', 'BAND', 'RSSI', 'RSRP/RSCP', 'RSRQ/ECIO', 'SNR', 'CQI', 'TA', 'DISTANCE', 'DELTA_AZI', 'LAT', 'LON', 'SPEED', 'GPS_ACCURACY', 'UL', 'DL', 'BANDWIDTH', 'BANDWIDTHS', 'CA', 'NR_STATE', 'NARFCN', 'NR_BAND', 'NR_PCI', 'NR_SS_RSRP', 'NR_SS_RSRQ', 'NR_SS_SINR', 'NR_CSI_RSRP', 'NR_CSI_RSRQ', 'NR_CSI_SINR', 'CLF_LABEL', 'CLF_LOC', 'CLF_DESC', 'DATE', 'TIME', 'ROAMING']
    const headersGMPOptimized = ['PLMN', 'SYSTEM', 'Cell', 'NB', 'LOCAL_CID', 'LAC', 'PCI', 'ARFCN', 'Band', 'RSSI', 'Signal', 'RSRQ', 'SNR', 'CQI', 'TA', 'DISTANCE', 'DELTA_AZI', 'Latitude', 'Longitude', 'SPEED', 'Accuracy', 'UL', 'DL', 'BANDWIDTH', 'Bandwidths', 'CA', 'NR_STATE', 'NARFCN', 'NR_BAND', 'NR_PCI', 'NR_SS_RSRP', 'NR_SS_RSRQ', 'NR_SS_SINR', 'NR_CSI_RSRP', 'NR_CSI_RSRQ', 'NR_CSI_SINR', 'CLF_LABEL', 'CLF_LOC', 'CLF_DESC', 'DATE', 'TIME', 'ROAMING']
    const headersTC = ['mcc', 'mnc', 'lac', 'cell_id', 'short_cell_id', 'rnc', 'psc', 'asu', 'dbm', 'ta', 'lat', 'lon', 'accuracy', 'speed', 'bearing', 'altitude', 'measured_at', 'net_type', 'neighboring', 'discovered_at', 'device', 'rsrp', 'rsrq', 'rssi', 'rssnr', 'cqi', 'rscp', 'csi_rsrp', 'csi_rsrq', 'csi_sinr', 'ss_rsrp', 'ss_rsrq', 'ss_sinr', 'cdma_dbm', 'cdma_ecio', 'evdo_dbm', 'evdo_ecio', 'evdo_snr', 'ec_no', 'arfcn']
    const headersTCOptimized = ['MCC', 'MNC', 'LAC', 'Cell', 'short_cell_id', 'rnc', 'PCI', 'asu', 'Signal', 'ta', 'Latitude', 'Longitude', 'Accuracy', 'speed', 'bearing', 'Altitude', 'Timestamp', 'Type', 'neighboring', 'discovered_at', 'device', 'rsrp', 'rsrq', 'rssi', 'rssnr', 'cqi', 'rscp', 'csi_rsrp', 'csi_rsrq', 'csi_sinr', 'ss_rsrp', 'ss_rsrq', 'ss_sinr', 'cdma_dbm', 'cdma_ecio', 'evdo_dbm', 'evdo_ecio', 'evdo_snr', 'ec_no', 'ARFCN']
    const mapping = { 'LTE-LTE': 256, 'NR-NSA': 0, 'NR-SA': 16384 };
    const invalidValues = ["-1", "0", "1", "", "9223372036854775807", "000000"];

    let map;
    let markerLayer = L.layerGroup();

    let allPoints = [];
    let filtered = []
    let markers = [];
    let latLngs = [];

    let currentFilters = {
      plmn: "",
      type: "",
      band: "",
      frequency: "",
      nb: "",
      cell: ""
    };

    let lastIsDesktop = window.innerWidth >= 768;
    let fileName = "No file selected";
    
    let eutraBands = [];
    let nrBands = [];
    let nrBandsSupport = [];
    let mapTemplate = "";

    loadData("https://cdn.jsdelivr.net/gh/NerdTech-aut/arfcn-to-frequency-files@refs/heads/main/EUTRA_operating_bands_frequencies_arfcn-numbers.json")
      .then(data => { eutraBands = data || []; })
      .catch(console.error);

    loadData("https://cdn.jsdelivr.net/gh/NerdTech-aut/arfcn-to-frequency-files@refs/heads/main/NR_operating_bands_frequencies_duplex-types_arfcn-numbers.json")
      .then(data => { nrBands = data || []; })
      .catch(console.error);

    loadData("https://cdn.jsdelivr.net/gh/NerdTech-aut/arfcn-to-frequency-files@refs/heads/main/NR-ARFCN_parameters_for_the_global_frequency_raster.json")
      .then(data => { nrBandsSupport = data || []; })
      .catch(console.error);

    loadData("./assets/resources/map-template.html", 'text')
      .then(data => { mapTemplate = data || ""; })
      .catch(console.error);

    function initMap() {
      map = L.map("map",{zoomControl: false}).setView([47.6965, 13.3457], 7);

      const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
      {
          minZoom: 7,
          maxZoom: 21,
          attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', 
      {
          minZoom: 7,
          maxZoom: 21,
          attribution: '© <a href="https://www.esri.com/en-us/home">Esri</a>, <a href="https://www.earthstar.com/">Earthstar Geographics</a>, <a href="https://www.maxar.com/">Maxar</a>, <a href="https://www.usda.gov/">USDA</a>, <a href="https://www.usgs.gov/">USGS</a>, <a href="https://www.aex.com/">AEX</a>, <a href="https://www.getmapping.com/">Getmapping</a>, <a href="https://www.aerogrid.com/">Aerogrid</a>, <a href="https://www.ign.fr/">IGN</a>, <a href="https://www.igp.pt/">IGP</a>, and the <a href="https://www.gisusercommunity.com/">GIS User Community</a>'
      });

      const baseMaps = {
          "OpenStreetMap": osm,
          "Esri Satellite": satellite
      };

      const overlayMaps = {
        ['<span class="d-block cursor-default"><span class="legend-color-block align-middle border border-secondary-subtle d-inline-block" style="background-color: #008000;"></span> -85 dBm and above</span>']: L.layerGroup(),
        ['<span class="d-block cursor-default"><span class="legend-color-block align-middle border border-secondary-subtle d-inline-block" style="background-color: #90EE90;"></span> between -86 dBm and -100 dBm</span>']: L.layerGroup(),
        ['<span class="d-block cursor-default"><span class="legend-color-block align-middle border border-secondary-subtle d-inline-block" style="background-color: #FFCCCB;"></span> between -101 dBm and -115 dBm</span>']: L.layerGroup(),
        ['<span class="d-block cursor-default"><span class="legend-color-block align-middle border border-secondary-subtle d-inline-block" style="background-color: #FF0000;"></span> -116 dBm and below</span>']: L.layerGroup()
      };

      const layersControl = L.control.layers(baseMaps, overlayMaps).addTo(map);

      markerLayer.addTo(map);

      const checkboxes = layersControl.getContainer().querySelectorAll('.leaflet-control-layers-list input[type="checkbox"]');
      checkboxes.forEach(function(cb) {
        const label = cb.closest('label');
        const labelClone = label.cloneNode(true);
        labelClone.querySelector('input[type="checkbox"]').remove();
        label.parentNode.replaceChild(labelClone.querySelector('.d-block.cursor-default'), label);
      });

      getLocation();
    }

    function setUserLocation(position)
    {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      console.log("User location: " + lat + ", " + lon);
      
      map.setView([lat, lon], 7);
    }

    function handleLocationError(error) 
    {
      console.log("Error getting location: " + error.message);
    }

    function getLocation() 
    {
      if (navigator.geolocation)
      {
        navigator.geolocation.getCurrentPosition(setUserLocation, handleLocationError, {timeout: 1000});
      } 
      else 
      {
        console.log("Geolocation is not supported by this browser.");
      }
    }

    //function to load external data
    async function loadData(url, returnType = 'json') {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error('HTTP error ' + response.status);
      }
      const data = returnType === 'json' ? await response.json() : await response.text();
      return data;
    }

    function parseCsv(text) {
      let rows = [];
      
      //split the text at newline and filter empty entries
      const lines = text.split("\n").filter(l => l.trim().length > 0);
      console.log(`${lines.length} rows in CSV`)

      if (lines.length == 0) return;

      if (lines[0].split(",").length == headersCM.length) { //for CellMapper
        //iterate over all the lines
        lines.forEach(line => {
          //split the line at the separator
          const cols = line.split(",");
          //when the line does not have the expected amount of columns skip the rest of the run
          if (cols.length !== headersCM.length) return;

          //construct the row as a dictionary/json
          const row = {};

          //iterate over the headers and set a new key value pair for the current header and the column value at the current header index
          headersCM.forEach((h, idx) => {
            row[h] = cols[idx]
          });

          //update the Latitude row by converting it into a float
          row.Latitude = parseFloat(row.Latitude)
          //update the Longitude row by converting it into a float
          row.Longitude = parseFloat(row.Longitude)
          //when the latitude or longitude value is not a number then skip the rest of the run
          if (isNaN(row.Latitude) || isNaN(row.Longitude)) return;

          //create new PLMN entry based von MCC and MNC when these values are not invalid
          row.PLMN = (!invalidValues.includes(row.MCC) || !invalidValues.includes(row.MNC)) ? `${row.MCC}-${row.MNC}` : "Unknown";
          
          //create new TypeSubtype entry based in Type and Subtype when these values are not invalid
          row.TypeSubtype = (!invalidValues.includes(row.Type) || !invalidValues.includes(row.Subtype)) ? `${row.Type}-${row.Subtype}` : "Unknown";
          //skip the rest of the run if type is not LTE or NR
          if (row.TypeSubtype.includes(["LTE", "NR"])) return;
          
          //update LAC entry if value is invalid
          row.LAC = (!invalidValues.includes(row.LAC)) ? row.LAC : "Unknown";
          //update Cell entry if value is invalid
          row.Cell = (!invalidValues.includes(row.Cell)) ? row.Cell : "Unknown";
          //update PCI entry if value is invalid
          row.PCI = (!invalidValues.includes(row.PCI)) ? row.PCI : "Unknown";
          //update ARFCN entry if value is invalid
          row.ARFCN = (!invalidValues.includes(row.ARFCN)) ? row.ARFCN : "Unknown";

          //get the divisor for the calculation of the NB based on TypeSubtype
          const divisor = mapping[row.TypeSubtype] ?? 1;
          //create a new NB entry by first convert and check if the Cell-ID is a finite number and then calculate the NB by converting the Cell-ID to a number, divide it by the divisor, and turning it into a while number
          row.NB = Number.isFinite(Number(row.Cell)) && divisor !== 0 ? String(Math.trunc(Number(row.Cell) / divisor)) : "Unknown";

          //create a new Band entry with the getBandNumber function
          row.Band = getBandNumber(row.ARFCN, row.Type);
          //create a new Frequency entry with the calculateFrequency function 
          row.Frequency = calculateFrequency(row.ARFCN, row.Type);
          //create a new Color entry with the determineMarkerColor function
          row.Color = determineMarkerColor(row.Signal);

          //add the finished row dict/json to the rows list
          rows.push(row);
        });
      } else if (lines[0].split(";").length == headersGMP.length && lines[0].split(";").every(h => headersGMP.includes(h))) { //for G-MoN Pro
        //iterate over all the lines except the first one
        lines.slice(1).forEach(line => {
          //split the line at the separator
          const cols = line.split(";");
          //when the line does not have the expected amount of columns skip the rest of the run
          if (cols.length !== headersGMP.length) return;

          //construct the row as a dictionary/json
          const row = {};

          //iterate over the headers and set a new key value pair for the current header and the column value at the current header index
          headersGMPOptimized.forEach((h, idx) => {
            row[h] = cols[idx]
          });
          
          row.Signal = isNaN(parseFloat(row.Signal)) && !isNaN(parseFloat(row.NR_SS_RSRP)) ? row.NR_SS_RSRP : row.Signal;
          if (invalidValues.includes(row.Signal)) return;

          //update PLMN entry if value is invalid
          row.PLMN = (!invalidValues.includes(row.PLMN)) ? row.PLMN.substring(0, 3) + "-" + row.PLMN.substring(3) : "Unknown";
          //update LAC entry if value is invalid
          row.LAC = (!invalidValues.includes(row.LAC)) ? row.LAC : "Unknown";
          //update Cell entry if value is invalid
          row.Cell = (!invalidValues.includes(row.Cell)) ? row.Cell : "Unknown";
          //update PCI entry if value is invalid
          row.PCI = (!invalidValues.includes(row.PCI)) ? row.PCI : "Unknown";
          //update NB entry if value is invalid
          row.NB = (!invalidValues.includes(row.NB)) ? row.NB : "Unknown";
          //update ARFCN entry if value is invalid
          row.ARFCN = (!invalidValues.includes(row.ARFCN)) ? row.ARFCN : "Unknown";
          //update PCI entry if value is invalid
          row.PCI = (!invalidValues.includes(row.PCI)) ? row.PCI : "Unknown";
          //update Altitude entry if value is invalid
          row.Altitude = (!invalidValues.includes(row.Altitude)) ? row.Altitude : "Unknown";
          //update Bandwidths entry if value is invalid
          row.Bandwidths = (!invalidValues.includes(row.Bandwidths)) ? row.Bandwidths : "Unknown";

          //create new MCC and MNC entries by splitting the PLMN entry at the separator when PLMN value is not invalid
          row.MCC = row.PLMN.split("-")[0] ?? "Unknown";
          row.MNC = row.PLMN.split("-")[1] ?? "Unknown";

          //create a new type entry based on the System entry
          row.Type = row.SYSTEM === "4" ? "LTE" : row.SYSTEM === "5" ? "NR" : "Unknown";
          row.TypeSubtype = row.SYSTEM === "4" ? `${row.Type}-LTE` : row.SYSTEM === "5" ? `${row.Type}-SA` : "Unknown";
          //skip the rest of the run if type is not LTE or NR
          if (row.TypeSubtype.includes(["LTE", "NR"])) return;

          //update the Band entry by removing the leading frequency number
          row.Band = row.Band.split(" ")[1] ?? "Unknown";

          //create a new Frequency entry with the calculateFrequency function 
          row.Frequency = calculateFrequency(row.ARFCN, row.Type);
          //create a new Color entry with the determineMarkerColor function
          row.Color = determineMarkerColor(row.Signal);

          //create a new Timestamp entry by combining the Date and Time entries
          row.Timestamp = `${row.DATE} ${row.TIME}`

          //add the finished row dict/json to the rows list
          rows.push(row);
        });
      } else if (lines[0].split(",").length == headersTC.length) { //for Tower Collector
        //iterate over all the lines except the first one
        lines.slice(1).forEach(line => {
          //split the line at the separator
          const cols = line.split(",");
          //when the line does not have the expected amount of columns skip the rest of the run
          if (cols.length !== headersTC.length) return;

          //construct the row as a dictionary/json
          const row = {};

          //iterate over the headers and set a new key value pair for the current header and the column value at the current header index
          headersTCOptimized.forEach((h, idx) => {
            row[h] = cols[idx]
          });

          //create new PLMN entry based von MCC and MNC when these values are not invalid
          row.PLMN = (!invalidValues.includes(row.MCC) || !invalidValues.includes(row.MNC)) ? `${row.MCC}-${row.MNC}` : "Unknown";
          
          //create new TypeSubtype entry based on Type when this value is not invalid
          row.TypeSubtype = row.Type === "LTE" ? `${row.Type}-LTE` : row.Type === "NR" ? `${row.Type}-SA` : "Unknown";
          //skip the rest of the run if type is not LTE or NR
          if (row.TypeSubtype.includes(["LTE", "NR"])) return;
          
          //update LAC entry if value is invalid
          row.LAC = (!invalidValues.includes(row.LAC)) ? row.LAC : "Unknown";
          //update Cell entry if value is invalid
          row.Cell = (!invalidValues.includes(row.Cell)) ? row.Cell : "Unknown";
          //update PCI entry if value is invalid
          row.PCI = (!invalidValues.includes(row.PCI)) ? row.PCI : "Unknown";
          //update ARFCN entry if value is invalid
          row.ARFCN = (!invalidValues.includes(row.ARFCN)) ? row.ARFCN : "Unknown";
          //get the divisor for the calculation of the NB based on TypeSubtype
          const divisor = mapping[row.TypeSubtype] ?? 1;
          //create a new NB entry by first convert and check if the Cell-ID is a finite number and then calculate the NB by converting the Cell-ID to a number, divide it by the divisor, and turning it into a while number
          row.NB = Number.isFinite(Number(row.Cell)) && divisor !== 0 ? String(Math.trunc(Number(row.Cell) / divisor)) : "Unknown";
          
          //create a new Band entry with the getBandNumber function
          row.Band = getBandNumber(row.ARFCN, row.Type);
          //create a new Frequency entry with the calculateFrequency function 
          row.Frequency = calculateFrequency(row.ARFCN, row.Type);
          //create a new Color entry with the determineMarkerColor function
          row.Color = determineMarkerColor(row.Signal);
          
          //update the Timestamp entry by aligning format with that of G-MoN Pro
          row.Timestamp = row.Timestamp.replace("T", " ").replace("Z", "").replaceAll("-", "/").replaceAll("\"", "");

          //add the finished row dict/json to the rows list
          rows.push(row);
        });
      }
      console.log(`Parsed ${rows.length} rows from CSV`);
      return rows;
    }

    function getBandNumber(arfcn, type) {
      //parse the ARFCN to an int
      const arfcnInt = parseInt(arfcn);
      //band selection when type is LTE and ARFCN is not NaN
      if (type.includes('LTE') && !isNaN(arfcnInt)) {
        //check whether eutraBands is not an empty array
        if (Array.isArray(eutraBands) && eutraBands.length) {
          let matchingBands = [];
          //iterate over the eutraBands list
          eutraBands.forEach(eutraBand => {
            //when the ARFCN is in the range between dl_arfcn_low and dl_arfcn_high
            if (arfcnInt >= eutraBand.dl_arfcn_low && arfcnInt <= eutraBand.dl_arfcn_high) {
              //when in range add the current band to the list
              matchingBands.push(eutraBand.eutra_operating_band);
            }
          });
          //return all bands as a string by joining all matching entries together
          return `${matchingBands.join("/")}`;
        }
        return "LTE Band ?";
      //band selection when type is NR and ARFCN is not NaN
      } else if (type.includes('NR') && !isNaN(arfcnInt)) {
        //check whether nrBands is not an empty array
        if (Array.isArray(nrBands) && nrBands.length) {
          let matchingBands = [];
          //iterate over the nrBand list
          nrBands.forEach (nrBand => {
            //when the ARFCN is in the range between dl_arfcn_low and dl_arfcn_high
            if (arfcnInt >= nrBand.dl_arfcn_low && arfcnInt <= nrBand.dl_arfcn_high) {
              //when in range add the current band to the list
              matchingBands.push(nrBand.nr_operating_band);
            }
          });
          //return all bands as a string by joining all matching entries together
          return `${matchingBands.join("/")}`;
        }
        return "NR Band ?";
      }
      return "Unknown Band";
    }

    function calculateFrequency(arfcn, type) {
      //convert ARFCN to an integer
      const arfcnInt = parseInt(arfcn);
      //frequency calculation when type is LTE and ARFCN is not NaN
      if (type.includes('LTE') && !isNaN(arfcnInt)) {
        //check whether eutraBands is not an empty array
        if (Array.isArray(eutraBands) && eutraBands.length) {
          let matchingEutraBand = {};
          //iterate over the eutraBands list
          eutraBands.forEach(eutraBand => {
            //when the ARFCN is in the range between dl_arfcn_low and dl_arfcn_high
            if (arfcnInt >= eutraBand.dl_arfcn_low && arfcnInt <= eutraBand.dl_arfcn_high) {
              //set the matching eutraBand item
              matchingEutraBand = eutraBand;
              return;
            }
          });
          //calculate the frequency with the formular FDL = FDL_low + 0.1 * (NDL - N_offs_UL)
          return String(Math.round((parseInt(matchingEutraBand.dl_freq_low_mHz) + 0.1 * (arfcnInt - parseInt(matchingEutraBand.n_offs_dl)) + Number.EPSILON) * 100) / 100);
        }
      //frequency calculation when type is NR and ARFCN is not NaN
      } else if (type.includes('NR') && !isNaN(arfcnInt)) {
        //check whether nrBandsSupport is not an empty array
        if (Array.isArray(nrBandsSupport) && nrBandsSupport.length) {
          let matchingNrBandSupport = {};
          //iterate over the nrBandsSupport list
          nrBandsSupport.forEach(nrBandSupport => {
            //when the ARFCN is in the range between n_ref_low and n_ref_high
            if (arfcnInt >= nrBandSupport.n_ref_low && arfcnInt <= nrBandSupport.n_ref_high) {
              //set the matching nrBandSupport
              matchingNrBandSupport = nrBandSupport;
              return;
            }
          });
          //calculate the frequency with the formular FDL = F_ref_offs + delta-freq_Global * (N_REF - N_REF-Offs)
          return String(Math.round((parseInt(matchingNrBandSupport.freq_ref_offs_mHz) + (parseInt(matchingNrBandSupport.delta_freq_global_kHz) / 1000) * (arfcnInt - parseInt(matchingNrBandSupport["n_ref-offs"])) + Number.EPSILON) * 100) / 100);
        }
      }
      return "Unknown";
    }

    function determineMarkerColor(signal) {
      if (signal >= -85) {
        return "#008000";
      } else if (signal >= -100) {
        return "#90EE90";
      } else if (signal >= -115) {
        return "#FFCCCB";
      } else {
        return "#FF0000";
      }
    }

    function updateFilterOptions() {
      //Sets are used because they are like lists but have the advantage that duplicates are ignored
      
      filtered = allPoints
      const plmnSet = new Set();
      const typeSet = new Set();
      const bandSet = new Set();
      const frequencySet = new Set();
      const nbSet = new Set();
      const cellSet = new Set();

      if (!currentFilters.plmn && !currentFilters.type && !currentFilters.band && !currentFilters.frequency && !currentFilters.nb && !currentFilters.cell) {
        //when no filters are applied add all unique values to the sets
        allPoints.forEach(p => {
          plmnSet.add(p.PLMN);
          typeSet.add(p.TypeSubtype);
          bandSet.add(p.Band);
          frequencySet.add(p.Frequency);
          nbSet.add(p.NB);
          cellSet.add(p.Cell);
        });
      } else {
        //always add all unique PLMNs
        //iterate over all of the points
        filtered.forEach(p => {
          //add the current PLMN to plmnSet
          plmnSet.add(p.PLMN);
        });

        if (currentFilters.plmn) {
          //create a subset of filtered by applying a filter which only keeps a point if the selected PLMN filter matches the PLMN value of the current point
          filtered = filtered.filter(p => currentFilters.plmn === p.PLMN);
        }
        //iterate over all remaining points after plmn filtering
        filtered.forEach(p => {
          //add the current TypeSubtype to typeSet
          typeSet.add(p.TypeSubtype);
        });

        if (currentFilters.type) {
          //create a subset of filtered by applying a filter which only keeps a point if the selected type filter matches the type value of the current point
          filtered = filtered.filter(p => currentFilters.type === p.TypeSubtype);
        }
        //iterate over all remaining points after type filtering
        filtered.forEach(p => {
          //add the current band to bandSet
          bandSet.add(p.Band);
        });

        if (currentFilters.band) {
          //create a subset of filtered by applying a filter which only keeps a point if the selected band filter matches the band value of the current point
          filtered = filtered.filter(p => currentFilters.band === p.Band);
        }
        //iterate over all remaining points after band filtering
        filtered.forEach(p => {
          //add the current Frequency to frequencySet
          frequencySet.add(p.Frequency);
        });

        if (currentFilters.frequency) {
          //create a subset of filtered by applying a filter which only keeps a point if the selected frequency filter matches the frequency value of the current point
          filtered = filtered.filter(p => currentFilters.frequency === p.Frequency);
        }
        //iterate over all remaining points after frequency filtering
        filtered.forEach(p => {
          //add the current NB to nbSet
          nbSet.add(p.NB);
        });

        if (currentFilters.nb) {
          //create a subset of filtered by applying a filter which only keeps a point if the selected NB filter matches the NB value of the current point
          filtered = filtered.filter(p => currentFilters.nb === p.NB);
        }
        //iterate over all remaining points after NB filtering
        filtered.forEach(p => {
          //add the current Cell to cellSet
          cellSet.add(p.Cell);
        });

        if (currentFilters.cell) {
          //create a subset of filtered by applying a filter which only keeps a point if the selected Cell filter matches the Cell value of the current point
          filtered = filtered.filter(p => currentFilters.cell === p.Cell);
        }
      }

      renderDropdown('filterPlmn', plmnSet);
      renderDropdown('filterType', typeSet);
      renderDropdown('filterBand', bandSet);
      renderDropdown('filterFrequency', frequencySet);
      renderDropdown('filterNb', nbSet);
      renderDropdown('filterCell', cellSet);
    }

    function renderDropdown(idBase, set) {
      const ul = document.getElementById(idBase + "UL");
      const search = document.getElementById(idBase + "Search");
      const selectedSpan = document.getElementById(idBase + "Selected");
      const noResults = document.getElementById(idBase + "NoResults");
      const btn = document.getElementById(idBase + "Btn");

      //with a.dropdown-item[data-value] search and NoResults are excluded from the query 
      ul.querySelectorAll('li a.dropdown-item[data-value]').forEach(a => {
        if (a.dataset.value !== "") a.parentElement.remove();
      });

      //create a sorted array based on the current set
      const sortedFilters = Array.from(set).sort((a,b) => {
        const an = Number(a)
        const bn = Number(b);
        //when both values are numbers calculate the difference between the two values 
        if (!Number.isNaN(an) && !Number.isNaN(bn)) return an - bn;
        //when at least one value is not a number use string comparison
        return a.localeCompare(b);
      });

      //get the all entry which is the first <li> with data-value=""
      const allEntry = ul.querySelector('a.dropdown-item[data-value=""]');
      //get the no result entry
      const noResultEntry = allEntry.parentElement.nextSibling;

      console.log(`Rendering dropdown ${idBase} with ${sortedFilters.length} entries`);
      
      //iterate over the sortedFilters list
      sortedFilters.forEach(sortedFilter => {
        //create a new list element
        const li = document.createElement('li');
        //create a new link element 
        const a = document.createElement('a');
        //configure the dropdown-item class for the new link element 
        a.className = 'dropdown-item';
        a.href = '#';
        a.classList.add("d-block")
        //configure value and text for the link element
        a.dataset.value = sortedFilter;
        a.textContent = sortedFilter;
        //add the link element to the list element
        li.appendChild(a);
        //add the list element to the list before the no result entry
        ul.insertBefore(li, noResultEntry);
      });

      //remove previously attached click handlers on dropdown items
      ul.querySelectorAll('a.dropdown-item').forEach(a => {
        if (a._customClickHandler) {
          a.removeEventListener('click', a._customClickHandler);
        }
      });

      //iterate over the just created list elements
      ul.querySelectorAll('a.dropdown-item').forEach(a => {
        //create a custom event handler for the current link element
        a._customClickHandler = function(e) {
          //prevent navigation to the link 
          e.preventDefault();

          //get the value from the selected link element
          const val = this.dataset.value;
          //save the base id in the click handler
          const key = idBase.replace('filter','');
          //reset the filter variables and the dropdown box text depending on the key
          if (key === 'Plmn') {
            currentFilters.plmn = val;
            currentFilters.type = "";
            currentFilters.band = "";
            currentFilters.frequency = "";
            currentFilters.nb = "";
            currentFilters.cell = "";
            filterTypeSelected.textContent = 'All';
            filterBandSelected.textContent = 'All';
            filterFrequencySelected.textContent = 'All';
            filterNbSelected.textContent = 'All';
            filterCellSelected.textContent = 'All';
          } else if (key === 'Type') {
            currentFilters.type = val;
            currentFilters.band = "";
            currentFilters.frequency = "";
            currentFilters.nb = "";
            currentFilters.cell = "";
            filterBandSelected.textContent = 'All';
            filterFrequencySelected.textContent = 'All';
            filterNbSelected.textContent = 'All';
            filterCellSelected.textContent = 'All';
          } else if (key === 'Band') {
            currentFilters.band = val;
            currentFilters.frequency = "";
            currentFilters.nb = "";
            currentFilters.cell = "";
            filterFrequencySelected.textContent = 'All';
            filterNbSelected.textContent = 'All';
            filterCellSelected.textContent = 'All';
          } else if (key === 'Frequency') {
            currentFilters.frequency = val;
            currentFilters.nb = "";
            currentFilters.cell = "";
            filterNbSelected.textContent = 'All';
            filterCellSelected.textContent = 'All';
          } else if (key === 'Nb') {
            currentFilters.nb = val;
            currentFilters.cell = "";
            filterCellSelected.textContent = 'All';
          } else if (key === 'Cell') {
            currentFilters.cell = val;
          }

          //update dropdown box text or reset it to all when the all element was selected
          selectedSpan.textContent = val ? val : 'All';
          //update the no results item to not visible when the all item was selected
          if (!val) noResults.classList.replace('d-block', 'd-none');

          updateFilterOptions();
          applyFilters();
        };
        //register the event handler
        a.addEventListener('click', a._customClickHandler);
      });

      //clear the search box
      search.value = '';
      //set the no results item to invisible
      noResults.classList.replace('d-block', 'd-none');
    }

    function applyFilters() {
      //reset the marker layer, the marker list an the coordinates list
      markerLayer.clearLayers();
      markers = [];
      latLngs = [];

      //iterate over the filtered elements
      filtered.forEach(p => {
        //create the circle marker options for the current point with the design
        //fill color is dynamic based on signal strength
        const circleMarkerOptions = {
          radius: 6,
          color: "#2c2f3a",
          weight: 1,
          fillColor: p.Color,
          fillOpacity: 1
        }

        //create the circle marker for the current point based on latitude, longitude and the circle marker options
        const marker = L.circleMarker([p.Latitude, p.Longitude], circleMarkerOptions);

        //create the popup html code
        const popupHtml = 
        `<table class="table table-sm table-striped">
          <tr>
            <th scope="row">PLMN</th>      <td>${p.PLMN}</td>
          </tr>
          <tr>
            <th scope="row">LAC ID</th>    <td>${p.LAC}</td>
          </tr>
          <tr>
            <th scope="row">NB ID</th>     <td>${p.NB}</td>
          </tr>
          <tr>
            <th scope="row">Cell ID</th>   <td>${p.Cell}</td>
          </tr>
          <tr>
            <th scope="row">PCI</th>       <td>${p.PCI}</td>
          </tr>
          <tr>
            <th scope="row">Frequency</th> <td>${p.Frequency} MHz</td>
          </tr>
          <tr>
            <th scope="row">ARFCN</th>     <td>${p.ARFCN}</td>
          </tr>
          <tr>
            <th scope="row">Band</th>      <td>${p.Band}</td>
          </tr>
          <tr>
            <th scope="row">Type</th>      <td>${p.TypeSubtype}</td>
          </tr>
          <tr>
            <th scope="row">Signal</th>    <td>${p.Signal} dBm</td>
          </tr>
          <tr>
            <th scope="row">${p.Altitude ? "Altitude" : p.Bandwidths ? "Bandwidths": ""}</th>  <td>${p.Altitude ? p.Altitude + " meters": p.Bandwidths ? p.Bandwidths + " MHz": ""}</td>
          </tr>
          <tr>
            <th scope="row">Latitude</th>  <td>${p.Latitude}</td>
          </tr>
          <tr>
            <th scope="row">Longitude</th> <td>${p.Longitude}</td>
          </tr>
          ${p.Timestamp ? 
          `<tr>
            <th scope="row">Timestamp</th> <td>${p.Timestamp}</td>
          </tr>` : ""}
          <tr>
            <th colspan="2"><a href="https://www.google.com/maps/search/${p.Latitude},+${p.Longitude}" target="_blank">View on Google Maps</a></th>
          </tr>
          <tr>
            <th colspan="2"><a href="https://www.openstreetmap.org/#map=19/${p.Latitude}/${p.Longitude}" target="_blank">View on OpenStreetMap</a></th>
          </tr>
          <tr>
            <th colspan="2"><a href="https://www.cellmapper.net/map?MCC=${p.MCC}&MNC=${p.MNC}&type=${p.Type}&latitude=${p.Latitude}&longitude=${p.Longitude}&zoom=15.3" target="_blank">View on CellMapper</a></th>
          </tr>
        </table>`;

        //create the tooltip text for the current item
        const toolTipText = `PLMN: ${p.PLMN} <br> Type: ${p.TypeSubtype} <br> NB ID: ${p.NB} <br> Cell ID: ${p.Cell} <br> Frequency: ${p.Frequency} MHz <br> Signal: ${p.Signal} dBm`;
        //bind the tooltip to the marker
        marker.bindTooltip(toolTipText, {permanent: false, direction: 'top', offset: [0, -8], opacity: 1});
        //bind the popup to the marker
        marker.bindPopup(popupHtml);
        //add the marker to the marker layer
        marker.addTo(markerLayer);
        //add the raw information about the marker to the markers list
        markers.push({ Latitude: p.Latitude, Longitude: p.Longitude, Icon: circleMarkerOptions, PopUp: popupHtml, ToolTip: toolTipText });
        //add the latitude and longitude to the coordinates list
        latLngs.push([p.Latitude, p.Longitude]);
      });

      //after the filtered points were added as markers
      //update the counter for the visible points
      visibleCount.textContent = filtered.length;

      //check if one or more markers was added to the map
      if (latLngs.length > 0) {
        //create a bounds object based on the coordinated of all markers
        const bounds = L.latLngBounds(latLngs);
        //set the bounds
        map.fitBounds(bounds.pad(0.2), { maxZoom: 19 });
      }
    }

    dropdowns.forEach(dropdown => {
      const ul = document.getElementById(dropdown.id + "UL");
      const search = document.getElementById(dropdown.id + "Search");
      const selectedSpan = document.getElementById(dropdown.id + "Selected");
      const noResults = document.getElementById(dropdown.id + "NoResults");
      const btn = document.getElementById(dropdown.id + "Btn");

      //create a custom search handler for the current search box
      search._customSearchHandler = function() {
        //get the current search value without starting or ending spaces in lower case
        const q = this.value.trim().toLowerCase();
        let hasResults = false;
        //iterate over all list elements of the dropdown
        ul.querySelectorAll('a.dropdown-item').forEach(a => {
          //always keep the all entry visible
          if (a.dataset.value === "") {
            //skip the rest of the run
            return;
          }
          //get the value of the current dropdown list element in lower case
          const txt = a.textContent.toLowerCase();
          //check whether the value of the current dropdown list element includes the search value
          if (txt.includes(q)) {
            //set matching dropdown list elements to visible
            a.classList.replace('d-none', 'd-block');
            hasResults = true;
          } else {
            //set not matching dropdown list elements to invisible
            a.classList.replace('d-block', 'd-none');
          }
        });
        //when there are no results set the no results item to visible
        if (hasResults) {
          noResults.classList.replace('d-block', 'd-none')
        } else {
          noResults.classList.replace('d-none', 'd-block')
        }
      };
      //register the event handler
      search.addEventListener('input', search._customSearchHandler);

      //create a custom event handler to focus the search input when the dropdown is opened
      btn._customShownHandler = function() {
        //delay the focusing by 10ms to ensure that he dropdown is open
        setTimeout(() => {
          try {
            //focus on the search box
            search.focus();
            //select the text in the search box if the select function exists
            if (typeof search.select === 'function') search.select();
          } catch (err) {
            //ignore focus errors
          }
        }, 10);
      };
      //register the event listener
      btn.addEventListener('shown.bs.dropdown', btn._customShownHandler);

      //to prevent closing the dropdown when clicking on the no results item
      noResults.removeEventListener('click', noResults._customClickHandler);
      noResults._customClickHandler = e => e.stopPropagation();
      noResults.addEventListener('click', noResults._customClickHandler);

      //create a custom keydown handler for the current search box
      search._customKeydownHandler = function(e) {
        //when the enter key is pressed
        if (e.key === 'Enter') {
          //get all visible dropdown items with a valid value
          const visibleItems = Array.from(ul.querySelectorAll('a.dropdown-item[data-value]')).filter(a => a.dataset.value !== "" && a.classList.contains('d-block'));
          //when there is only one valid visible dropdown item
          if (visibleItems.length === 1) {
            //click on the sole visible item to select it
            visibleItems[0].click();
          }
        }
      };
      //register the event handler
      search.addEventListener('keydown', search._customKeydownHandler);
    });

    btnSaveMap.addEventListener('click', async event => {
      try {
        //check if there are markers to save
        if (markers.length === 0) {
          emptyMapModel.show();
          //skip the rest of the function when there are no markers on the map to save
          return;
        }
        
        //create the filename suggestion by replacing the .csv extension with .html and a hint that it is a map
        const suggestedFileName = fileName.replace('.csv', `${Object.entries(currentFilters).map(([k, v]) => (`${v ? '_' + v : ''}`)).join('')}_map.html`);
        //create the content for the file by replacing the placeholders in the template file with json stringified versions of the markers and latLngs lists
        const content = mapTemplate.replace("filteredDataJSON = []", `filteredDataJSON = ${JSON.stringify(markers)}`).replace("latLngs = []", `latLngs = ${JSON.stringify(latLngs)}`);

        //check whether the current browser has save file picker support
        if (typeof window.showSaveFilePicker === 'function') {
          //create a save file picker with the suggested filename & filetype html and get the resulting FileSystemFileHandle
          const handle = await window.showSaveFilePicker({
            suggestedName: suggestedFileName,
            types: [{
              description: 'HTML Files',
              accept: { 'text/html': ['.html'] },
            }],
          });

          //create a FileSystemWritableFileStream to write the file based on the FileSystemFileHandle 
          const writable = await handle.createWritable();
          //write the file
          await writable.write(content);
          //close the writer
          await writable.close();
        //when there is no save file picker support
        } else {
          successfulMapModelText.innerText = `Do you want to download the file ${suggestedFileName} with ${markers.length} points?`
          successfulMapModel.show();
          btnDownload.removeEventListener('input', btnDownload._customDownloadHandler);
          btnDownload._customDownloadHandler = function(e) {
            successfulMapModel.hide()
            //create a file blob with the file content and setting the file type
            const blob = new Blob([content], { type: 'text/html;charset=utf-8' });
            //creation of a blob url based on the file blob
            const url = URL.createObjectURL(blob);
            //create a new invisible link element with the blob url and the suggested filename
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = suggestedFileName;

            //add the invisible link element to the DOM
            document.body.appendChild(a);
            //programmatically click on the invisible link element
            a.click();
            //after 100ms remove the hidden link element from the DOM and revoke the blob url
            setTimeout(() => {
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
            }, 100);
          }
          btnDownload.addEventListener('click', btnDownload._customDownloadHandler);
        }
      } catch (err) {
        console.error('Save cancelled or failed:', err);
      }
    });

    //csv uploader function
    csvFile.addEventListener("change", event => {
      //get the new file
      const file = event.target.files[0];
      //when the new file is empty but there was another file selected previously
      if (file == null && fileName != "No file selected") {
        //recreate the previously selected file
        const previousFile = new File(allPoints, fileName, {
          type: 'text/csv',
          lastModified: Date.now(),
        });
        //create a new data transfer and add the recreated previous File
        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(previousFile);
        //assign the files in the dataTransfer object to the file-input element which overrides that there is no file selected
        csvFile.files = dataTransfer.files;
      }
      //get the filename but if now no file was selected and there was previously a file keep the filename of the previously selected file
      fileName = (file != null) ? file.name : (fileName != "No file selected" ? fileName : "No file selected");
      console.log(`Selected file: ${fileName}`);
      //skip the rest of the function when no new file was selected
      if (!file) return;

      const reader = new FileReader();
      //create custom function on how the reading of the file is done
      reader.onload = e => {
        //get the result from the reading and use custom parseCsv function to parse the file then save the result in the allPoints variable
        allPoints = parseCsv(e.target.result);
        //update the total points counter
        totalCount.textContent = allPoints.length;

        resetDropdowns();
        updateFilterOptions();
        applyFilters();

        //automatically hide the data and filters section on mobile after the file selection
        //check if which is small enough
        if (window.innerWidth < 768) {
          //collapse the card body programmatically
          mobileHeader.click();
          lastIsDesktop = false;
        }
      };
      //read the file
      reader.readAsText(file);
    });

    //function to clear all filters on button click
    btnClearFilters.addEventListener("click", () => {
      resetDropdowns();
      updateFilterOptions();
      applyFilters();
    });

    function resetDropdowns () {
      //reset the filters variable
      currentFilters = { plmn: "", type: "", band: "", arfcn: "", nb: "", cell: "" };

      //iterate over all filters
      ['Plmn','Type','Band','Frequency','Nb','Cell'].forEach(k => {
        //set the text of the dropdown box back to all
        document.getElementById('filter' + k + 'Selected').textContent = 'All';
        //empty the search box text - necessary because if there is text in the search box with no match this clears the the no matches found item from the list 
        document.getElementById('filter' + k + 'Search').value = '';
        //iterate over the dropdown items
        //with a.dropdown-item[data-value] search and NoResults are excluded from the query 
        document.getElementById('filter' + k + 'UL').querySelectorAll('li a.dropdown-item[data-value]').forEach(a => {
          //only remove a dropdown item if it isn't the All item
          if (a.dataset.value !== "") a.parentElement.remove();
        });
      });
    }

    mobileHeader.addEventListener('click', () => {
      //when the mobile card body is now visible 
      if (mobileHeader.getAttribute('aria-expanded') == "true") {
        //indicate that the card is now expanded with the down arrow
        collapseIcon.classList.replace('bi-chevron-down', 'bi-chevron-up')
        //show the border of the mobile card header
        mobileHeader.classList.remove('border-bottom-0')
        //bottom edge of the mobile card header should be straight
        mobileHeader.classList.remove('rounded-bottom-4')
      //when the mobile card body is now invisible 
      } else {
        //indicate that the card is now collapsed with the up arrow
        collapseIcon.classList.replace('bi-chevron-up', 'bi-chevron-down')
        //hide the border of the mobile card header
        mobileHeader.classList.add('border-bottom-0')
        //bottom edge of the mobile card header should be rounded
        mobileHeader.classList.add('rounded-bottom-4')
      }
    });

    // Theme toggle event listener
    themeToggle.addEventListener('click', () => {
      //determine the new theme based on the current icon
      const newTheme = themeIcon.classList.contains('bi-moon-fill') ? 'light' : 'dark';
      //save the new theme to local storage
      localStorage.setItem('savedTheme', newTheme);
      //apply the new theme
      updateTheme(newTheme, newTheme === 'light', newTheme === 'dark');
    });

    function updateTheme(newTheme, isLight, isDark) {
      bodyElement.setAttribute('data-bs-theme', newTheme);
      bodyElement.classList.toggle('bg-dark-subtle', isLight);
      contentContainer.classList.toggle('bg-light-subtle', isLight);
      contentContainer.classList.toggle('bg-primary-subtle', isDark);
      configCard.classList.toggle('bg-light', isLight);
      configCard.classList.toggle('bg-secondary-subtle', isDark);
      themeIcon.classList.toggle('bi-sun-fill', isLight);
      themeIcon.classList.toggle('bi-moon-fill', isDark);
    }

    //initialize the map once the DOM is ready
    window.addEventListener("load", () => {
      initMap();
    });

    //resizing event listener 
    window.addEventListener("resize", () => {
      //get the real size of the window
      //this helps to prevent some erroneous size reports
      rect = document.documentElement.getBoundingClientRect();
      realSize = { width: rect.width, height: rect.height };
      //create bool whether the width is 768px or above or not
      const isDesktop = realSize.width >= 768;
      //only execute if the current status does not match the last recorded status
      //this is to prevent hiding the card body when resizing with width below 768px 
      if (isDesktop !== lastIsDesktop) {
        //update the previous status variable
        lastIsDesktop = isDesktop;
        //when width is 768px or above
        if (isDesktop) {
          console.log(window.innerWidth)
          //show the card body
          cardBody.classList.add("show")
        //when width is below 768px
        } else {
          //hide the card body
          cardBody.classList.remove("show")
          //update the mobile card header arrow
          collapseIcon.classList.replace('bi-chevron-up', 'bi-chevron-down')

          //update bottom border and shape of the mobile card header
          mobileHeader.classList.add('border-bottom-0')
          mobileHeader.classList.add('rounded-bottom-4')
        }
      }
    });
  </script>
</body>
</html>